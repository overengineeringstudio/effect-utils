# Oxc Configuration Pattern

Configuration patterns for oxlint (linting) and oxfmt (formatting) using genie-generated
JSON config files with shared base configs.

## Overview

- **oxlint**: Fast JavaScript/TypeScript linter (Rust-based, ESLint-compatible rules)
- **oxfmt**: Fast code formatter (Rust-based, Prettier-compatible)

Both tools auto-discover config files at repo root (`oxlint.json`, `oxfmt.json`).

## File Structure

```
repo-root/
├── oxlint.json              # Generated by genie
├── oxlint.json.genie.ts     # Genie source
├── oxfmt.json               # Generated by genie
├── oxfmt.json.genie.ts      # Genie source
└── genie/
    ├── oxlint-base.ts       # Shared base config (in effect-utils)
    └── oxfmt-base.ts        # Shared base config (in effect-utils)
```

## Genie Helpers

Located in `@overeng/genie`:

```ts
import { oxlintConfig, oxfmtConfig } from '@overeng/genie/runtime'
```

### oxlintConfig

Generates `oxlint.json` with proper structure:

```ts
oxlintConfig({
  plugins: ['import', 'typescript', 'unicorn', 'oxc'],
  jsPlugins: ['./path/to/custom-plugin.ts'],
  categories: {
    correctness: 'error',
    suspicious: 'warn',
    pedantic: 'off',
  },
  rules: {
    'import/no-commonjs': 'error',
    'typescript/no-deprecated': 'error',
  },
  overrides: [{ files: ['**/test/**'], rules: { 'some-rule': 'off' } }],
})
```

### oxfmtConfig

Generates `oxfmt.json`:

```ts
oxfmtConfig({
  semi: false,
  singleQuote: true,
  printWidth: 100,
  tabWidth: 2,
  trailingComma: 'all',
  experimentalSortImports: {
    groups: ['builtin', 'external', 'internal', ['parent', 'sibling', 'index']],
    internalPattern: ['@overeng/', '@local/'],
    newlinesBetween: true,
  },
  ignorePatterns: ['**/*.gen.ts'],
})
```

## Shared Base Configs

Base configs live in `effect-utils/genie/` and are imported by all repos.

### oxlint-base.ts

Exports:

| Export                 | Description                                |
| ---------------------- | ------------------------------------------ |
| `baseOxlintPlugins`    | Standard plugins: import, typescript, etc. |
| `baseOxlintCategories` | Category severity levels                   |
| `baseOxlintRules`      | Common rules shared across repos           |
| `baseOxlintOverrides`  | Standard file-pattern overrides            |
| `generatedFilesRules`  | Rules disabled for `*.gen.*` files         |

### oxfmt-base.ts

Exports:

| Export                    | Description                  |
| ------------------------- | ---------------------------- |
| `baseOxfmtOptions`        | Formatting options           |
| `baseOxfmtIgnorePatterns` | Patterns for generated files |

## Usage Examples

### effect-utils (defines base)

```ts
// oxlint.json.genie.ts
import {
  baseOxlintCategories,
  baseOxlintOverrides,
  baseOxlintPlugins,
  baseOxlintRules,
} from './genie/oxlint-base.ts'
import { oxlintConfig } from './packages/@overeng/genie/src/runtime/mod.ts'

export default oxlintConfig({
  plugins: baseOxlintPlugins,
  jsPlugins: ['./packages/@overeng/oxc-config/src/mod.ts'],
  categories: baseOxlintCategories,
  rules: baseOxlintRules,
  overrides: [
    ...baseOxlintOverrides,
    // effect-utils specific overrides
    {
      files: ['**/react-inspector/**'],
      rules: { 'func-style': 'off' },
    },
  ],
})
```

### Other repos (extend base)

```ts
// oxlint.json.genie.ts
import {
  baseOxlintCategories,
  baseOxlintOverrides,
  baseOxlintPlugins,
  baseOxlintRules,
} from '../effect-utils/genie/oxlint-base.ts'
import { oxlintConfig } from '../effect-utils/packages/@overeng/genie/src/runtime/mod.ts'

export default oxlintConfig({
  plugins: baseOxlintPlugins,
  jsPlugins: ['../effect-utils/packages/@overeng/oxc-config/src/mod.ts'],
  categories: baseOxlintCategories,
  rules: {
    ...baseOxlintRules,
    // repo-specific rule overrides
    'unicorn/prefer-array-find': 'off',
  },
  overrides: [
    ...baseOxlintOverrides,
    // repo-specific overrides
    {
      files: ['**/next.config.js'],
      rules: { 'import/no-commonjs': 'off' },
    },
  ],
})
```

## Custom Rules

Custom oxlint rules (JS plugins) live in `@overeng/oxc-config`:

```
packages/@overeng/oxc-config/src/
├── mod.ts              # Plugin entry point
├── named-args.ts       # Rule: enforce named arguments
├── exports-first.ts    # Rule: exports before non-exports
└── jsdoc-require-exports.ts
```

Reference via `jsPlugins` in config:

```ts
jsPlugins: ['./packages/@overeng/oxc-config/src/mod.ts']
```

## Key Rules Explained

### `oxc/no-barrel-file`

Disallows re-exports except in designated entry points. Helps with tree-shaking
and avoids circular dependency issues.

**Allowed in**: `**/mod.ts` (via override)

### `import/no-commonjs`

Enforces ESM over CommonJS. Required for modern bundling and tree-shaking.

**Disabled for**: CommonJS config files (tailwind.config.js, etc.)

### `import/no-cycle`

Detects circular dependencies. These cause runtime issues and make code harder
to reason about.

### `overeng/named-args`

Enforces options objects over positional parameters for functions with multiple
arguments. Improves readability and makes refactoring safer.

### `overeng/exports-first`

Requires exported declarations to come before non-exported ones. Makes it easier
to scan a file's public API.

### `overeng/jsdoc-require-exports`

Requires JSDoc comments on exported declarations. Documents the public API.

## Running Lint/Format

Via mono CLI:

```bash
./scripts/mono.ts lint        # Check formatting and linting
./scripts/mono.ts lint --fix  # Auto-fix issues
```

Direct:

```bash
oxlint .
oxfmt --check .
oxfmt --write .
```

## Regenerating Configs

After modifying `*.genie.ts` files:

```bash
./scripts/mono.ts check  # Includes genie check
# or directly
bun genie
```
