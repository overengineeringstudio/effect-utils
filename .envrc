#!/usr/bin/env bash

export WORKSPACE_ROOT=$(pwd)

if test -f ./.envrc.local; then
  source_env ./.envrc.local
fi

if command -v nix-shell &> /dev/null
then
  eval "$(devenv direnvrc)"
  use devenv

  # Auto-rebuild Nix CLIs on reload; set MONO_AUTO_REBUILD=0 to disable.
  if [ "${MONO_AUTO_REBUILD:-1}" != "0" ]; then
    if command -v mono >/dev/null 2>&1; then
      if ! mono nix status --scope devenv --check >/dev/null 2>&1; then
        echo "direnv: auto rebuilding Nix CLIs (set MONO_AUTO_REBUILD=0 to disable)"
        mono nix build --package all
      fi
    fi
  fi
fi
