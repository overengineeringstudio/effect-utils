#!/usr/bin/env bash

export WORKSPACE_ROOT=$(pwd)

if test -f ./.envrc.local; then
  source_env ./.envrc.local
fi

# Keep mono/dev overrides in-repo so direnv reload matches local changes.
DEVENV_BASE_OVERRIDES="--override-input mono path:./scripts --override-input workspace path:${WORKSPACE_ROOT}"
if test -n "${DEVENV_OVERRIDES-}"; then
  DEVENV_OVERRIDES="${DEVENV_BASE_OVERRIDES} ${DEVENV_OVERRIDES}"
else
  DEVENV_OVERRIDES="${DEVENV_BASE_OVERRIDES}"
fi

if command -v nix-shell &> /dev/null
then
  eval "$(devenv direnvrc)"
  # Apply overrides after loading .envrc.local so local tweaks can append.
  use devenv ${DEVENV_OVERRIDES-}
fi
